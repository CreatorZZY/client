<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gingko Writer Database Download</title>
  <script src="https://unpkg.com/dexie"></script>
  <script src="https://unpkg.com/dexie-export-import"></script>
</head>
<body>
<h1>Your download should begin automatically...</h1>
<script>
  const dbs = await indexedDB.databases();
  const dbName = dbs[0].name;

  const loadScript = src =>
    new Promise(resolve => {
      let script = document.createElement('script')
      script.src = src;
      script.onload = resolve;
      document.body.appendChild(script);
    })

  let db = new Dexie(dbName);
  const { verno, tables } = await db.open();
  db.close();

  db = new Dexie(dbName);
  db.version(verno).stores(tables.reduce((p,c) => {
    p[c.name] = c.schema.primKey.keyPath || "";
    return p;
  }, {}));

  const blob = await db.export({
    numRowsPerChunk: 2
  });

  var a = document.createElement("a");
  document.body.appendChild(a);
  a.href = window.URL.createObjectURL(blob);
  a.download = "gingko-writer-db-export.json";
  a.click();
  window.URL.revokeObjectURL(url);
</script>

</body>
</html>